#!/bin/bash

step_file="/root/.malware_step"
if [ ! -f "$step_file" ]; then echo 1 > "$step_file"; fi
step=$(cat "$step_file")

# Ã‰tape 1 : Processus suspect
if [[ "$step" == "1" ]]; then
    echo -e "\nğŸ” \033[36mÃ‰tape 1 : Identification dâ€™un processus suspect.\033[0m"
    echo "Fichier Ã  consulter : /tmp/process_list.txt"
    echo "Commande : cat /tmp/process_list.txt"
    echo -e "\033[33m(Note : RepÃ©rez les processus suspects comme ceux contenant 'crypt' ou 'nc')\033[0m"
    read -p "Avez-vous consultÃ© la liste ? (y/n) : " a
    [[ "$a" != "y" ]] && echo -e "\033[31mVeuillez consulter le fichier avec : cat /tmp/process_list.txt\033[0m" && exit 0
    read -p "ğŸŸ¡ Question : Quel processus semble suspect ? " answer
    if echo "$answer" | grep -iq "cryptominer"; then
        echo -e "\033[32mâœ… Ã‰tape 1 validÃ©e !\033[0m"
	echo ""
        echo 2 > "$step_file"
    else
        echo -e "\033[31mâŒ Mauvaise rÃ©ponse. Indice : un mineur de crypto ?\033[0m"
    fi
    exit 0
fi

# Ã‰tape 2 : Fichier suspect
if [[ "$step" == "2" ]]; then
    echo -e "\nğŸ“ \033[36mÃ‰tape 2 : Analyse dâ€™un fichier suspect.\033[0m"
    echo "Fichier Ã  analyser : /tmp/suspicious_file.py"
    echo "Commande : cat /tmp/suspicious_file.py"
    read -p "Avez-vous lu le fichier ? (y/n) : " a
    [[ "$a" != "y" ]] && echo -e "\033[31mVeuillez lire le fichier avec : cat /tmp/suspicious_file.py\033[0m" && exit 0
    read -p "ğŸŸ¡ Question : Quelle action dangereuse est rÃ©alisÃ©e ? " answer
    if echo "$answer" | grep -iqE "reverse shell|socket"; then
        echo -e "\033[32mâœ… Ã‰tape 2 validÃ©e !\033[0m"
	echo ""
        echo 3 > "$step_file"
    else
        echo -e "\033[31mâŒ Mauvaise rÃ©ponse. Indice : une connexion Ã  distance ?\033[0m"
    fi
    exit 0
fi

# Ã‰tape 3 : Logs rÃ©seau
if [[ "$step" == "3" ]]; then
    echo -e "\nğŸŒ \033[36mÃ‰tape 3 : Analyse des connexions rÃ©seau.\033[0m"
    echo "Fichier Ã  consulter : /tmp/network_logs.txt"
    read -p "Avez-vous lu les logs ? (y/n) : " a
    [[ "$a" != "y" ]] && echo -e "\033[31mVeuillez lire le fichier avec : cat /tmp/network_logs.txt\033[0m" && exit 0
    read -p "ğŸŸ¡ Question : Quelle IP semble suspecte ? " answer
    if echo "$answer" | grep -q "192.168.56.66"; then
        echo -e "\033[32mâœ… Ã‰tape 3 validÃ©e !\033[0m"
	echo ""
        echo 4 > "$step_file"
    else
        echo -e "\033[31mâŒ Ce nâ€™est pas la bonne IP. Analyse les ports et services.\033[0m"
    fi
    exit 0
fi

# Ã‰tape 4 : Tentative d'exfiltration
if [[ "$step" == "4" ]]; then
    echo -e "\nğŸ“¤ \033[36mÃ‰tape 4 : Tentative dâ€™exfiltration dÃ©tectÃ©e\033[0m"
    echo "Fichier : /tmp/exfiltration_attempt.log"
    read -p "Avez-vous consultÃ© le fichier ? (y/n) : " a
    [[ "$a" != "y" ]] && echo -e "\033[31mVeuillez lire le fichier avec : cat /tmp/exfiltration_attempt.log\033[0m" && exit 0
    read -p "ğŸŸ¡ Question : Quel protocole a Ã©tÃ© utilisÃ© ? " answer
    if echo "$answer" | grep -iq "ftp"; then
        echo -e "\033[32mâœ… Ã‰tape 4 validÃ©e !\033[0m"
	echo ""
        echo 5 > "$step_file"
    else
        echo -e "\033[31mâŒ Mauvaise rÃ©ponse. Indice : vieux protocole ?\033[0m"
    fi
    exit 0
fi

# Ã‰tape 5 : RÃ©sumÃ© Ã  valider
if [[ "$step" == "5" ]]; then
    echo -e "\nğŸ“ \033[36mÃ‰tape 5 : Validation du rÃ©sumÃ© de lâ€™analyse\033[0m"
    echo "Fichier Ã  lire : /tmp/summary.txt"
    read -p "Avez-vous lu le rÃ©sumÃ© ? (y/n) : " a
    [[ "$a" != "y" ]] && echo -e "\033[31mVeuillez lire le fichier avec : cat /tmp/summary.txt\033[0m" && exit 0
    read -p "ğŸŸ¡ Question : Le malware a-t-il Ã©tÃ© neutralisÃ© ? " answer
    if echo "$answer" | grep -iq "oui"; then
        echo -e "\033[32mâœ… Ã‰tape 5 validÃ©e !\033[0m"
	echo ""
	echo -e "\nğŸ‰ \033[32mFÃ©licitations ! Vous avez complÃ©tÃ© le scÃ©nario Malware.\033[0m"
        echo -e "ğŸ›¡ï¸ N'oubliez jamais de vÃ©rifier les processus, connexions rÃ©seau et comportements suspects."
    else
        echo -e "\033[31mâŒ Mauvaise rÃ©ponse. Relis le rÃ©sumÃ©.\033[0m"
    fi
    exit 0
fi

